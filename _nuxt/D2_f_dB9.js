import{u as y,d as x,a as f}from"./C_rUSLnT.js";import{n as j,y as d,G as _,c as h,o as S}from"./BbsFhn3w.js";const I=["innerHTML"],k={__name:"Twemojify",props:{text:{type:String,required:!0},png:{type:Boolean,required:!1}},async setup(v){let l,p;const t=v,o=y(`twemojify:${t.png?"png":"svg"}`,()=>({})),s=j(t.text),c=(n,r)=>o.value[n]?s.value.replace(t.text.slice(...r),o.value[n]):s.value,m=async()=>{const n=x.parse(t.text,{assetType:t.png?"png":"svg"});for(const{url:r,indices:i,text:e}of n){if(o.value[e]){s.value=c(e,i);continue}if(t.png)o.value[e]=`<img src="${r}" class="twemojify" />`;else{{const{expiresIn:a}=f().twemoji,w=localStorage.getItem("twemoji-expiry");if(a>0){Date.now()>Number(w)&&(localStorage.removeItem(`twemojify-${e}`),localStorage.setItem("twemoji-expiry",String(Date.now()+a*1e3)));const g=localStorage.getItem(`twemojify-${e}`);if(g){o.value[e]=g,s.value=c(e,i);continue}}}const u=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" class="twemojify">${(await $fetch(r,{responseType:"text"}).then(a=>a).catch(()=>"")).replace(/<\/*svg[^>]*>/g,"")}</svg>`;o.value[e]=u;{const{expiresIn:a}=f().twemoji;a>0&&localStorage.setItem(`twemojify-${e}`,u)}}s.value=c(e,i)}};return d(()=>t,async()=>{s.value=t.text,await m()},{deep:!0}),[l,p]=_(()=>m()),await l,p(),(n,r)=>(S(),h("span",{innerHTML:s.value},null,8,I))}};export{k as default};
